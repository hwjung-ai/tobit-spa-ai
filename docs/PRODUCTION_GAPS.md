# Tobit SPA AI - 프로덕션 로드맵 (MVP → Production)

## 1. 문서 개요

이 문서는 현재 MVP(Minimum Viable Product) 상태인 Tobit SPA AI를 안정적인 프로덕션(운영) 환경에 적용하기 위해 **반드시 보완되어야 할 기능 및 기술 부채 TODO 리스트**입니다.

> **참고**: 이 문서는 운영 안정성 관점의 필수 보완 사항을 추적하기 위한 것이며, 일반적인 기능 요구사항과는 별도로 관리됩니다. 작업 진행 시 이 문서의 항목을 체크하고 내용을 업데이트하세요.

---

## 2. 완료된 P0 항목 (✅ Completed)

### P0-1: Request Tracing & Audit Logging System ✅
- **설명**: 요청별 trace_id/parent_trace_id를 통한 분산 추적 및 모든 중요 변경사항의 감사 로그 기록
- **구현 상태**: 완료
- **주요 기능**:
  - 미들웨어에서 trace_id 자동 생성 및 전파
  - 로깅에 trace_id/parent_trace_id 포함
  - TbAuditLog 테이블: 리소스별 변경 이력 추적
  - 자산 레지스트리(publish/rollback) 감사 로그 통합
- **소스**:
  - 미들웨어: `apps/api/core/middleware.py`
  - 로깅: `apps/api/core/logging.py`
  - 감사 모델: `apps/api/app/modules/audit_log/models.py`
  - 감사 CRUD: `apps/api/app/modules/audit_log/crud.py`
  - 마이그레이션: `apps/api/alembic/versions/0023_add_audit_log.py`

### P0-2: Asset Registry System ✅
- **설명**: 자산(Asset) 버전 관리, 발행/롤백 기능을 통한 자산 수명주기 관리
- **구현 상태**: 완료
- **주요 기능**:
  - Asset 정의 및 버전 관리
  - Publish/Rollback을 통한 버전 제어
  - 자산 변경 이력 추적
  - P0-1 감사 로그 통합
- **소스**:
  - 모델/CRUD: `apps/api/app/modules/asset_registry/`
  - 마이그레이션: `apps/api/alembic/versions/0022_add_asset_registry.py`

### P0-3: Runtime Settings Externalization ✅
- **설명**: OPS_MODE, ops_enable_langgraph 등 런타임 플래그를 설정 관리 시스템으로 외부화
- **구현 상태**: 완료
- **주요 기능**:
  - 설정 우선순위: published > env > default
  - GET /settings/operations: 모든 설정 조회
  - PUT /settings/operations/{key}: 설정 변경
  - 설정 변경 이력 감사 로그 기록
  - 변경 적용 시 restart_required 플래그 제공
- **설정 항목**:
  - ops_mode (mock/real)
  - ops_enable_langgraph (bool)
  - enable_system_apis (bool)
  - enable_data_explorer (bool)
  - cep_enable_metric_polling (bool)
  - cep_metric_poll_global_interval_seconds (int)
  - cep_metric_poll_concurrency (int)
  - cep_enable_notifications (bool)
  - ops_enable_cep_scheduler (bool)
- **소스**:
  - 모델: `apps/api/app/modules/operation_settings/models.py`
  - CRUD: `apps/api/app/modules/operation_settings/crud.py`
  - 서비스: `apps/api/app/modules/operation_settings/services.py`
  - 라우터: `apps/api/app/modules/operation_settings/router.py`
  - 마이그레이션: `apps/api/alembic/versions/0024_add_operation_settings.py`
  - 테스트: `apps/api/tests/test_operation_settings.py` (9/9 passing)

---

## 3. Common Features (공통 기능)

모든 모듈에 걸쳐 필요한 최우선 공통 과제입니다.

### 🔴 P0: 즉시 필요
1.  **인증 및 권한 관리**:
    - 사용자 인증 (JWT/OAuth2)
    - 역할 기반 접근 제어 (RBAC: Role-Based Access Control)
    - 리소스(API, UI, CI) 및 데이터별 접근 권한
    - 테넌트 격리 강화
2.  **보안 처리 상세**:
    - 로그인/로그아웃 (비밀번호 암호화) 및 SSO 연동 기반 마련
    - 요청/응답 암호화 및 HTTPS 강제
    - API Key 기반의 REST API 보안
    - URL 공유 기능 (인증 없는 접근, 권한 위임, 공유 이력)
3.  **감사 로그 (Audit Log)**:
    - 모든 중요 변경(C/U/D) 이력 및 사용자 활동 추적
    - 데이터 접근 로그 기록 및 보관 정책
4.  **로그 처리 표준화**:
    - 표준 로그 포맷 정의 (JSON 형식 권장)
    - 콘솔 및 파일 동시 출력, 로그 레벨 관리
    - 로그 로테이션 및 보관 정책
5.  **테스트 관리**:
    - 단위/통합/E2E 테스트 커버리지 관리
    - 기능 개발 시 테스트 케이스 동시 작성 문화
    - REST API 및 UI 렌더링 테스트 자동화

### 🟠 P1: 단기 필요
6.  **관리자 화면**:
    - 사용자/테넌트별 토큰 사용량 및 시스템 리소스 모니터링
    - 시스템 로그 조회 및 다운로드
    - 프롬프트/쿼리/Query Asset 관리 UI (draft/publish/rollback, SQL read-only bible view)
    - Query asset 변경/Publish/rollback은 Inspector trace와 Audit Log에 기록되어야 하며, docs/QUERY_ASSET_OPERATION_GUIDE.md를 참조하여 SQL 자산을 운영합니다.
7.  **백업 및 복구**:
    - 정기 자동 백업 및 검증
    - 데이터 복구 프로세스 수립
8.  **배포 및 설치**:
    - 원격 설치 및 자동 실행 스크립트 (`tobitspaai_YYYYMMDD.sh`)
    - Cython 빌드를 통한 소스 코드 보호
    - 이중화 구성을 위한 Docker 기반 패키징 검토
9.  **문서화**:
    - 최종 사용자 가이드, 운영 매뉴얼, 트러블슈팅 가이드

---

## 3. API Manager (API 매니저)

### 🔴 P0: 즉시 필요
1.  **버전 관리 및 변경 이력**: API 정의에 대한 버전 관리, 변경 이력(who, when, what), 변경 사유 기록 및 Diff 표시 기능이 필요합니다.
2.  **롤백 기능**: 이전 버전으로 API 정의를 되돌리는 기능이 필요합니다.
3.  **API 검증 및 테스트**: API 저장 전 SQL 문법, 스키마 유효성 등을 자동으로 검증하는 기능이 필요합니다.
4.  **권한 관리**: API별 실행 및 수정 권한, API 타입(system/custom)별 권한을 관리해야 합니다.

### 🟠 P1: 단기 필요
5.  **성능 모니터링**: API별 평균 실행 시간, 실패율, 슬로우 쿼리 등 성능 메트릭을 수집하고 시각화해야 합니다.
6.  **에러 처리 강화**: 사용자 친화적 에러 메시지, 재시도 정책, 실패 알림 기능이 필요합니다.
7.  **의존성 관리**: 워크플로우 내 API 간 의존성을 추적하고, API 변경/삭제 시 영향도를 분석해야 합니다.

### 🟡 P2: 중기 필요
8.  **캐싱**: API 응답 및 쿼리 결과 캐싱 전략을 도입하여 성능을 최적화합니다.
9.  **배치 및 스케줄링**: API를 배치 또는 스케줄 기반으로 자동 실행하는 기능이 필요합니다.

---

## 4. UI Creator (UI 크리에이터)

### 🔴 P0: 즉시 필요
1.  **UI 정의 버전 관리**: UI 스키마의 변경 이력을 추적하고, 이전 버전으로 롤백하는 기능이 필요합니다.
2.  **UI 검증 및 테스트**: 스키마 유효성, 데이터 소스 엔드포인트 연결성을 저장 전에 검증해야 합니다.
3.  **권한 관리**: UI별 접근, 수정, 공유 권한을 관리하고 테넌트별로 격리해야 합니다.

### 🟠 P1: 단기 필요
4.  **에러 처리 및 폴백**: 데이터 소스 실패 또는 타임아웃 발생 시, UI가 깨지지 않고 사용자에게 명확한 메시지를 보여줘야 합니다.
5.  **성능 최적화**: 데이터 로딩 성능 모니터링, 캐싱, 지연 로딩(lazy loading) 등을 도입해야 합니다.
6.  **UI 템플릿 및 라이브러리**: 자주 사용하는 UI 패턴을 템플릿으로 제공하여 재사용성을 높여야 합니다.

### 🟡 P2: 중기 필요
7.  **고급 차트 및 대시보드**: 라인 차트 외에 다양한 차트(bar, pie 등)를 지원하고, 위젯을 드래그앤드롭으로 배치하는 등 대시보드 기능을 고도화합니다.

---

## 5. CEP Engine (CEP 엔진)

### 🔴 P0: 즉시 필요
1.  **Rule 버전 관리**: Rule의 변경 이력을 추적하고 이전 버전으로 롤백하는 기능이 필요합니다.
2.  **Rule 테스트 및 검증**: Rule 저장 전 유효성을 검사하고, 시뮬레이션 결과를 검증하는 체계가 필요합니다.
3.  **다양한 알림 채널**: 현재 Webhook만 지원하나, 이메일, SMS, Slack 등 다양한 채널 연동이 필요합니다.

### 🟠 P1: 단기 필요
4.  **Bytewax 통합 및 고도화**: Windows에 설치된 Bytewax 엔진과 연동하여 실시간 이벤트 처리, 대시보드 UI, 처리 액션 관리 기능을 구현합니다.
5.  **Rule 성능 모니터링**: Rule별 실행 통계, 트리거 빈도, 실패 원인을 분석하여 성능을 관리합니다.
6.  **Rule 스케줄링 고도화**: `interval` 외에 Cron 표현식을 지원하고, 시간대 설정을 지원해야 합니다.
7.  **Rule 디버깅 도구**: Rule 실행 과정을 실시간으로 추적하고 상세 로그를 확인할 수 있는 디버깅 모드가 필요합니다.

### 🟡 P2: 중기 필요
8.  **Rule 템플릿 및 라이브러리**: 자주 사용하는 규칙을 템플릿으로 제공하거나, 공유 가능한 라이브러리 형태로 관리합니다.

---

## 6. OPS AI (AIOps Assistant)

### 🔴 P0: 즉시 필요
1.  **오케스트레이터 고도화 (핵심)**:
    - 현재의 단일 질의-응답 구조를 넘어, 최종 답변을 위해 필요한 정보를 **재귀적으로 탐색하고 조합**하는 기능이 필요합니다.
    - LangGraph, LlamaIndex 등 외부 라이브러리 통합을 적극 검토하고 적용하여 복잡한 추론을 수행해야 합니다.
    - 조건부 분기, 병렬/순차 실행 최적화 등 고급 워크플로우를 지원해야 합니다.
2.  **CI 변경 관리**: CI 데이터의 변경 이력을 추적하고, 필요한 경우 변경 승인 워크플로우를 도입해야 합니다.
3.  **CI 데이터 정합성**: 중복 CI를 감지하고, 정기적으로 데이터 무결성을 검증하는 프로세스가 필요합니다.

### 🟠 P1: 단기 필요
4.  **질의 성능 최적화**: 복잡한 그래프 순회나 집계 질의에 대한 타임아웃을 관리하고, 결과를 캐싱하여 성능을 개선해야 합니다.
5.  **실시간 데이터 연계**: TIM+ 등 외부 시스템과 연계하여 실시간 이벤트 및 메트릭 데이터를 수집하고 분석에 활용해야 합니다.
6.  **CI 자동화 및 통합**: 외부 시스템과 CI 정보를 동기화하고, CI 라이프사이클(생성-사용-폐기)을 관리해야 합니다.

### 🟡 P2: 중기 필요
7.  **분석 기능 고도화**: 그래프 DB 기반의 최적 경로, 근본 원인 분석(RCA) 등 고급 분석 기능을 템플릿화하여 제공합니다.
8.  **이상징후 검출**: ML 기반 알고리즘 또는 동적 임계치를 활용하여 시스템의 이상 징후를 자동으로 검출합니다.
9.  **AI 질의 시스템 고도화**: 사용자의 이전 질의를 학습하여 질문을 추천하거나 자동 완성하는 기능이 필요합니다.

---

## 7. Document Search (문서 검색)

### 🔴 P0: 즉시 필요
1.  **문서 처리 고도화**:
    - PDF 외에 PPT, DOC, XLS 등 다양한 문서 형식을 지원해야 합니다.
    - 대용량 파일은 비동기 백그라운드 방식으로 처리하고, UI에서 처리 상태(업로드 → 파싱 → 완료)를 표시해야 합니다.
    - 검색 결과의 출처(페이지, 문단 등)를 명확히 표시하여 신뢰도를 높여야 합니다.
2.  **문서 관리 및 접근 제어**:
    - 문서 업로드/삭제 이력을 DB에 기록하고, 파일 시스템과 동기화해야 합니다.
    - 테넌트, 사용자별로 문서를 격리하고 접근 권한을 관리해야 합니다.

---

## 8. Chat & History (대화 및 이력)

### 🔴 P0: 즉시 필요
1.  **이력 관리 고도화**:
    - 각 대화 쓰레드에 대해 자동으로 요약 제목을 생성해야 합니다.
    - 각 질의응답마다 소요 시간 및 토큰 사용량을 표시해야 합니다.
    - 답변에 포함된 차트, 테이블 등의 결과물을 이력에 함께 저장해야 합니다.
2.  **이력 검색 및 관리**: 이력 목록을 검색하거나, 소프트 삭제(soft delete)하는 기능이 필요합니다.

---

## 9. Data Explorer (데이터 탐색기)

### 🔴 P0: 즉시 필요 (프로덕션 활성화 시)
1.  **프로덕션 활성화 여부 결정**: 현재 개발 전용인 이 기능을 프로덕션 환경에서 사용할지 정책 결정이 필요합니다.
2.  **권한 관리 및 감사**: 활성화 시, 데이터베이스 및 테이블별 접근 권한을 제어하고, 모든 쿼리 실행 기록을 감사 로그로 남겨야 합니다.

---
## 11. 우선순위 요약

### P0: 즉시 시작 (부분 완료)
**완료된 항목** (✅):
- **공통**: 감사 로그 (Audit Log) ✅, Request Tracing ✅
- **운영 설정**: 런타임 플래그 외부화 ✅

**여전히 필요한 항목**:
- **공통**: 인증/권한, 보안 (HTTPS/암호화), 로그 표준화, 테스트 관리
- **OPS AI**: 오케스트레이터 고도화 (재귀/분기 처리), CI 변경 관리
- **API/UI/CEP**: 버전 관리 및 롤백 기능
- **문서 검색/대화**: 핵심 기능 고도화 (다중 형식 지원, 이력 관리 강화)

### P1: 단기 (1-3개월)
- **공통**: 관리자 화면, 백업/복구, 배포 자동화
- **OPS AI**: 질의 성능 최적화, 실시간 데이터 연계
- **CEP 엔진**: Bytewax 통합, 알림 채널 확장, 성능 모니터링
- **API/UI 매니저**: 성능 모니터링, 에러 처리 강화

### P2: 중기 (3-6개월)
- **전체**: 고급 분석 기능, 템플릿/라이브러리, 캐싱 등 성능 고도화
- **OPS AI**: 이상징후 검출, AI 질의 추천
- **CEP 엔진**: Rule 디버깅 도구, 스케줄링 고도화
